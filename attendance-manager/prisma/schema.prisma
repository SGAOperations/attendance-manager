generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Role {
  roleId   String   @id @default(uuid())
  roleType RoleType
  users    User[]
}

model User {
  userId     String       @id @default(uuid())
  nuid       String       @unique
  email      String       @unique
  firstName  String
  lastName   String
  roleId     String
  password   String
  attendance Attendance[]
  role       Role         @relation(fields: [roleId], references: [roleId])
  
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  deletedAt  DateTime?
  updatedBy  String?
  updatedByUser User?     @relation("UserUpdatedBy", fields: [updatedBy], references: [userId])
  updatedUsers User[]     @relation("UserUpdatedBy")
  updatedMeetings Meeting[] @relation("MeetingUpdatedBy")
  updatedRequests Request[] @relation("RequestUpdatedBy")
}

model Meeting {
  meetingId  String       @id @default(uuid())
  name       String
  date       String
  startTime  String
  endTime    String
  notes      String
  type       MeetingType
  attendance Attendance[]
  
  createdAt  DateTime     @default(now())
  updatedAt  DateTime     @updatedAt
  deletedAt  DateTime?
  updatedBy  String?
  updatedByUser User?      @relation("MeetingUpdatedBy", fields: [updatedBy], references: [userId])
}

model Attendance {
  attendanceId String           @id @default(uuid())
  userId       String
  meetingId    String
  status       AttendanceStatus
  meeting      Meeting          @relation(fields: [meetingId], references: [meetingId])
  user         User             @relation(fields: [userId], references: [userId])
  request      Request?

  @@unique([userId, meetingId])
}

model Request {
  requestId      String          @id @default(uuid())
  attendanceId   String          @unique
  reason         String
  attendanceMode AttendanceMode
  timeAdjustment TimeAdjustment?
  attendance     Attendance      @relation(fields: [attendanceId], references: [attendanceId])
  
  createdAt      DateTime        @default(now())
  updatedAt      DateTime        @updatedAt
  deletedAt      DateTime?
  updatedBy      String?
  updatedByUser  User?           @relation("RequestUpdatedBy", fields: [updatedBy], references: [userId])
}

enum RoleType {
  EBOARD
  MEMBER
}

enum AttendanceStatus {
  PRESENT
  UNEXCUSED_ABSENCE
  EXCUSED_ABSENCE
  PENDING
}

enum MeetingType {
  FULL_BODY
  REGULAR
}

enum AttendanceMode {
  ONLINE
  IN_PERSON
}

enum TimeAdjustment {
  ARRIVING_LATE
  LEAVING_EARLY
}
