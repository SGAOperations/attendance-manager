generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Role {
  roleId   String   @id @default(uuid())
  roleType RoleType
  users    User[]
}

model User {
  userId     String       @id @default(uuid())
  supabaseAuthId String?  @unique
  nuid       String       @unique
  email      String       @unique
  firstName  String
  lastName   String
  roleId     String
  password   String?  // Optional - Supabase handles authentication
  attendance Attendance[]
  role       Role         @relation(fields: [roleId], references: [roleId])
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @default(now()) @updatedAt
}

model Meeting {
  meetingId  String       @id @default(uuid())
  name       String
  date       String
  startTime  String
  endTime    String
  notes      String
  type       MeetingType
  attendance Attendance[]
  votingEvents VotingEvent[]
}

model Attendance {
  attendanceId String           @id @default(uuid())
  userId       String
  meetingId    String
  status       AttendanceStatus
  meeting      Meeting          @relation(fields: [meetingId], references: [meetingId])
  user         User             @relation(fields: [userId], references: [userId])
  request      Request?

  @@unique([userId, meetingId])
}

model Request {
  requestId      String          @id @default(uuid())
  attendanceId   String          @unique
  reason         String
  attendanceMode AttendanceMode
  timeAdjustment TimeAdjustment?
  attendance     Attendance      @relation(fields: [attendanceId], references: [attendanceId])
  isLate Boolean @default(false)
}

model VotingEvent {
  votingEventId  String          @id @default(uuid())
  meetingId      String
  name           String
  voteType       String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime?       @updatedAt
  deletedAt      DateTime?
  updatedBy      String?
  meeting        Meeting         @relation(fields: [meetingId], references: [meetingId])
  votingRecords  VotingRecord[]
}

model VotingRecord {
  votingRecordId String          @id @default(uuid())
  votingEventId  String
  userId         String
  result         String
  createdAt      DateTime        @default(now())
  updatedAt      DateTime?       @updatedAt
  deletedAt      DateTime?
  updatedBy      String?
  votingEvent    VotingEvent     @relation(fields: [votingEventId], references: [votingEventId])
}

enum RoleType {
  EBOARD
  MEMBER
}

enum AttendanceStatus {
  PRESENT
  UNEXCUSED_ABSENCE
  EXCUSED_ABSENCE
  PENDING
}

enum MeetingType {
  FULL_BODY
  REGULAR
}

enum AttendanceMode {
  ONLINE
  IN_PERSON
}

enum TimeAdjustment {
  ARRIVING_LATE
  LEAVING_EARLY
}
